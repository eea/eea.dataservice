<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:javascript fill-slot="javascript_head_slot">
  <script tal:attributes="src string:$portal_url/++resource++eea.dataservice.convert_figures.js"
    type="text/javascript"></script>
</metal:javascript>

<body>

<div metal:fill-slot="main"
     tal:define="convert python:request.get('convert', None);
                 figures python:request.get('figures', None)">
 <h1 i18n:translate="">Convert all figures</h1>

 <div tal:condition="convert">
   <p class="documentDescription" i18n:translate="">
     This operation might take a while, a notification
     will be sent to user@eea.europa.eu after each convertion is done.
   </p>
   <p class="documentDescription" i18n:translate="">
     The following figures will be converted:
   </p>

   <ul>
     <tal:figures repeat="figure figures">
       <li tal:define="figure_title python:context[figure].Title"
           tal:content="figure_title" />
     </tal:figures>
   </ul>
 </div>

 <!-- form name="frmConvert" action="@@convertAllFigures" method="put" -->
 <form name="frmConvert" method="put" id="convert-all"
       tal:condition="not:convert"
       tal:attributes="action string:${context/absolute_url}/convert_maps">
  <input class="context" type="submit" name="convert" value="Convert" />
  <input class="context" type="submit" name="cancel" value="Cancel" />

  <br /><br />
  <input type="checkbox" name="checkAll" id="checkAll" value="Check all" title="Check all" />
  <label for="checkAll" title="Check all">Check all</label>

 <dl class="convert-all-figures">
  <tal:figures repeat="figure python:context.objectValues('EEAFigureFile')">
   <dt tal:define="figure_title figure/title_or_id;
                   figure_id figure/getId">
     <input type="checkbox" name="figures"
            tal:attributes="value figure_id;
                            id figure_id;
                            title figure_title" />
     <label tal:content="figure_title"
            tal:attributes="title figure_title;
                            for figure_id"/>
   </dt>
   <dd>
     state:
     <tal:state content="python:context.portal_workflow.getInfoFor(figure, 'review_state', 'Unknown')" />
   </dd>
   <dd>
     filename:
     <tal:filename content="figure/getFilename" />
   </dd>
   <dd tal:define="info figure/@@convertionInfo">
     last converted:
     <tal:date condition="info" content="python:toLocalizedTime(info, long_format=1)" />
     <tal:date condition="not:info"> - </tal:date>
   </dd>
  </tal:figures>
 </dl>

 </form>
</div>

</body>
</html>
