<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eea.translations">

<metal:javascript fill-slot="javascript_head_slot">
  <script tal:attributes="src string:$portal_url/++resource++eea.dataservice.organisations.js"
    type="text/javascript"></script>
</metal:javascript>

<body>

<div metal:fill-slot="main"
     tal:define="action python:request.get('action', '')"
     tal:condition="python:not portal.portal_membership.isAnonymousUser()">
<h1>Organisations overview</h1>

<tal:block condition="python:action == 'organisations-quick-overview'">
  <tal:quickOverview define="organisations python:context.getFolderContents(contentFilter={'portal_type':'Organisation', 'sort_on':'getUrl'})">
  <h2 id="organisations-quick-overview">Quick overview</h2>
  <p>Below is the full list of organisations.</p>
  <p id="organisations-status">
     <img id="organisations-loading"
          tal:attributes="src string:${context/absolute_url}/ajax-loader-small.gif" />
     URLs status checked: <span id="org-status-checked"
                                tal:content="python:'0/'+str(len(organisations))"></span>
  </p>
  <ul id="organisations-container">
    <tal:organisations repeat="org organisations">
    <li tal:define="org_id python:org.getId.replace('.', '-')"
        tal:attributes="id org_id">
      <a tal:attributes="href string:${org/getURL};
                         title org/Title"
         tal:content="org/Title" /><br />
      <strong>organisation URL:</strong>
      <span tal:attributes="id string:${org_id}-url" tal:content="org/getUrl" /><br />
      <strong>Google search:</strong>
      <a target="_blank"
         title="Google search"
         tal:attributes="href python:'http://www.google.ro/search?q=%s&ie=utf-8&oe=utf-8&aq=t' % org.Title.replace(' ', '+')">see more ...</a><br />
      <strong>URL status:</strong>
      <em tal:attributes="id string:${org_id}-loading">loading ...</em>
    </li>
    </tal:organisations>
  </ul>
  </tal:quickOverview>
</tal:block>

<tal:block condition="python:action == 'duplicate-organisations'">
  <h2>Duplicate organisations</h2>
  <p></p>
  <ul tal:define="urls python:context.organisations_overview_data(info='duplicates')"
      tal:condition="urls">
    <tal:block repeat="org_url python:urls.keys()">
    <li tal:define="organisations python:urls[org_url]"
        tal:condition="python:len(organisations) > 1">
      <a tal:attributes="href org_url" tal:content="org_url" /><br />
      <ul>
        <li tal:repeat="org organisations">
          <a tal:attributes="href string:${org/getURL};
                             title org/Title"
             tal:content="org/Title" /><br />
          <strong>organisation URL:</strong> <span tal:content="org/getUrl" /><br />
        </li>
      </ul>
    </li>
    </tal:block>
  </ul>
</tal:block>

<tal:block condition="python:action == 'organisations-with-wrong-title'">
  <h2>Organisations with wrong title</h2>
  <p>Below is a list of organisations with wrong title, either empty or containing an URL instead of a title.</p>
  <ul tal:define="organisations python:context.getFolderContents(contentFilter={'portal_type':'Organisation', 'sort_on':'getUrl'})">
    <tal:block repeat="org organisations">
    <li tal:condition="python:org.Title == '' or org.Title.startswith('http://') or org.Title.startswith('www')">
      <a tal:attributes="href string:${org/getURL};
                         title org/Title"
         tal:content="org/Title" /><br />
      <strong>organisation title:</strong> <span tal:content="org/Title" /><br />
      <strong>organisation URL:</strong> <span tal:content="org/getUrl" /><br />
    </li>
    </tal:block>
  </ul>
</tal:block>

<tal:block condition="python:action == 'organisations-with-no-reference'">
  <h2>Organisations with no reference</h2>
  <p>Below is a list of organisations on which no content is pointing at.</p>
  <ul tal:define="organisations python:context.organisations_overview_data(info='references')"
      tal:condition="organisations">
    <li tal:repeat="org organisations">
      <a tal:attributes="href org/getURL;
                         title org/Title"
         tal:content="org/Title" />
    </li>
  </ul>
</tal:block>

</div>

</body>
</html>