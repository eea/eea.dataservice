<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eea">

<head>
    <metal:javascript fill-slot="javascript_head_slot">
        <script type="text/javascript"
          tal:content="string:jQuery(document).ready(Figures.Load);"></script>
    </metal:javascript>
</head>

<body>

<div metal:fill-slot="content-core" tal:define="
  lastVersion context/@@getLatestVersionLink;
  versions nocall:here/@@getVersions;
  isVersionEnhanced here/@@isVersionEnhanced;">

    <!-- Versions -->
    <metal:versions use-macro="here/portlet_versions/macros/versions">
    </metal:versions>

  <!-- EEAFigureFiles -->
  <tal:figurefiles define="
    categView nocall:context/@@getCategoryName;
    singlefile context/@@getSingleEEAFigureFile;
    figurefiles context/@@getEEAFigureFiles">
    <div tal:condition="singlefile" class="map-singlefile">
      <tal:doc define="doc python:singlefile.getObject()">
        <tal:fancybox replace="structure doc/@@fancybox.html" />
        <div class="visualClear"></div>
      </tal:doc>
    </div>
      <div class="paginate">
    <tal:figures metal:define-macro="figures-album" 
      tal:repeat="child figurefiles">
      <tal:child define="
        Batch python:modules['Products.CMFPlone'].Batch;
        b_start python:request.get('b_start', 0);
        folderContents python:Batch(child[1], 100, int(b_start), orphan=1);
        categ python:child[0];
        categ_name python:categView(categ);
        entry_macro here/eeafigure_albumentry/macros/entry;
        ">
        <h3 tal:content="categ_name" tal:attributes="
          id string:fancy-$categ;
          title categ_name;"/>

       <!-- NEW MACRO FOR DAVIZ -->
       <!-- metal:figures use-macro="here/atct_album_view/macros/listing" / -->
        <div class="map-photo-album">
          <tal:listingmacro tal:define="
    entry_macro entry_macro | here/atct_albumentry/macros/entry;
    folderContents folderContents|nothing">

  <tal:folderContents condition="folderContents" tal:define="batch folderContents">
    <div metal:use-macro="here/batch_macros/macros/navigation" />
    <tal:images tal:repeat="brain folderContents">
      <tal:entry tal:define="
        obj brain/getObject;
        obj_title python:obj.pretty_title_or_id();
        desc_or_title python:brain.Description or obj_title;
        urlview obj/@@url;
        listing_url obj/absolute_url;
        is_video python:'eea.mediacentre.interfaces.IVideo' in brain.object_provides">

        <!-- a class="moreLink" tal:attributes="href string:${obj/absolute_url}/"
                                tal:condition="exists: obj/@@daviz-view.html"
                                i18n:translate="">View and interact online</a -->

        <tal:block condition="not:exists: obj/@@daviz-view.html">
           <metal:entry use-macro="entry_macro" />
        </tal:block>
        <tal:block condition="exists: obj/@@daviz-view.html"
                   define="suffix string:;
                           bgimg string:background-image: url(/valentine-imagescales/daviz/image_thumb)">
           <metal:entry use-macro="entry_macro" />
        </tal:block>

          <tal:comment tal:replace="nothing">
              TODO: ichimdav see if this code will still be useful, I have
              added it in a tal comment to avoid it being added to the html
              document adding unnecessary file size
          <!-- div tal:condition="not:exists:obj/@@daviz-view.html" tal:define="
             css python:brain.is_folderish and 'photoAlbumEntry photoAlbumFolder' or 'photoAlbumEntry'"
             tal:attributes="class css">
                  <a tal:attributes="
                        href string:${obj/absolute_url};
                        class python:test(is_video, 'video-fancybox', '');
                        title desc_or_title">
                        <span class="photoAlbumEntryWrapper">
                          <img style="border: none" tal:attributes="
                             title desc_or_title;
                                   alt obj/pretty_title_or_id;
                                   src string:${obj/absolute_url}/image_thumb"/>
                          </span>
                          <span class="photoAlbumEntryTitle" tal:content="obj/pretty_title_or_id" />
                   </a>
              </div -->
          </tal:comment>

      </tal:entry>
    </tal:images>
    <div class="visualClear"><!-- --></div>
    <div metal:use-macro="here/batch_macros/macros/navigation" />
  </tal:folderContents>
  </tal:listingmacro>
          </div>
       <!-- END NEW MACRO FOR DAVIZ -->
      </tal:child>
    </tal:figures>
 </div>
  </tal:figurefiles>

    <!-- META DATA -->
    <metal:related use-macro="here/dataset_view/macros/more-info" />

    <div class="metadata-container">
    <dl>
       <metal:related use-macro="here/dataset_view/macros/last-upload" />
       <metal:related use-macro="here/dataset_view/macros/temp-coverage" />
       <tal:tags define="facetId string:c9">
            <metal:related use-macro="here/dataset_view/macros/tags" />
       </tal:tags>
       <metal:related use-macro="here/dataset_view/macros/geo-coverage" />
       <metal:related use-macro="here/dataset_view/macros/methodology" />
       <metal:related use-macro="here/dataset_view/macros/units" />
       <metal:related use-macro="here/dataset_view/macros/rights" />
       <metal:related use-macro="here/dataset_view/macros/owners" />
       <metal:related use-macro="here/dataset_view/macros/processors" />
       <metal:related use-macro="here/dataset_view/macros/eea-mp-code" />
       <metal:related use-macro="here/dataset_view/macros/eea-contact-reference" />
       <metal:basicmeta use-macro="context/versions_macros/macros/permalinks" />

       <!-- Figure type -->
       <tal:block define="field python:context.getField('figureType');
                          vocab python:field.Vocabulary(context);
                          values python:field.getAccessor(context)();
                          value python:context.displayValue(vocab, values)"
                  condition="value">
          <dt>
            <metal:basic use-macro="here/dataset_view/macros/tooltip" />
            <span i18n:translate="">Figure type:</span>
          </dt>
          <dd tal:content="structure value">Figure type</dd>
       </tal:block>

    </dl>
    </div>

    <div class="visualClear">&nbsp;</div>

</div>

</body>
</html>
